# SurrealDB x OpenAI

This repository provides an example of a Retrival Augmented Generation (RAG) application leveraging OpenAI and SurrealDB for vector storage and search.

In this project, we demonstrate how to import a large dataset (comprising 25k Wikipedia articles) that includes vectors (embeddings generated by OpenAI) and then perform RAG question-answering using OpenAI's GPT models.

## Requirements

This project has been developed with the following environment:

- Apple M2 Pro: MacOS Sonoma 14.4
- SurrealDB 1.3.0: Configured as an on-disk server
- Python 3.11

Should you encounter any issues or unexpected behaviors, please feel free to reach out.

## Getting Started

Ensure you have [SurrealDB installed](https://surrealdb.com/install) on your machine. For Python 3.11 installation, we recommend using [pyenv](https://github.com/pyenv/pyenv).

Clone this repository using:

```bash
git clone https://github.com/Ce11an/surrealdb-openai.git
```

To interact with embedding and chat models, this project utilises the OpenAI API. An OpenAI API key is required to run this project. For more information on obtaining an API key, please refer to the [OpenAI Developer Quickstart](https://platform.openai.com/docs/quickstart). Currently, SurrealDB does not support the direct injection of [environment variables](https://github.com/surrealdb/surrealdb/issues/3362). As a workaround, we have provided a function in [rag_functions.surql](https://github.com/Ce11an/surrealdb-openai/blob/main/schema/rag_functions.surql) to manually set your OpenAI API key:

```sql
DEFINE FUNCTION IF NOT EXISTS fn::get_openai_token() {
    RETURN "Bearer <place-your-key-here>"
};
```

*Note:* This project is intended for example purposes only and is not recommended for production use. Ensure your OpenAI API key remains confidential.

### SurrealDB Configuration

With your environment set up, you can utilise `make` commands to prepare SurrealDB:

To launch SurrealDB as an on-disk server:

```bash
make surreal-start
```

To initialise the database with table and function definitions:

```bash
make surreal-init
```

To remove your database, if needed:

```bash
make surreal-remove
```

### Python Setup

Activate the Python virtual environment:

```bash
source venv/bin/activate
```

Install the project dependencies:

```bash
pip install -e .
```

### Downloading the Dataset

We will utilise a dataset provided by OpenAI: the Simple English Wikipedia dataset (~700MB zipped, 1.7GB CSV file), which includes vector embeddings. These vectors, with 1536 dimensions, are generated using OpenAI's `text-embedding-ada-002` model. To download the dataset:

```bash
get-data
```

### Insert Data into SurrealDB

To insert the dataset into SurrealDB:

```bash
surreal-insert
```

### Performing RAG Operations

To interact with SurrealDB using the SurrealQL interface:

```bash
make surreal-sql
```

Example query for RAG operations:

```sql
RETURN fn::surreal_rag("gpt-3.5-turbo", "Who is the greatest basketball player of all time?", 0.85);
```

## Considerations

While this project focuses on performing RAG with SurrealDB and SurrealQL, after the data insertion, you are free to query the database using any preferred programming language. Additionally, tools such as LangChain can be leveraged for enhanced functionality.

